---
output: html_document
editor_options: 
  chunk_output_type: console
---
# Gramática de datos

  - Recopilación
  - Importación
  - Exploración
    * Diccionario de variables
    * Niveles de agregación
    * Descripción univariada 
    * Identificando relaciones
    * Aproximación Visual (Visualización)
  - Filtrado y selección
    * Filtrado de observaciones
    * Selección de variables
    * Pivot, Reshape
    * Uniendo bases de datos
  - Muestreo, estimación, error estándar y confiabilidad
    * Diseño muestral
    * Estimación
    * Rendimiento
  - Transformación
    * Adecuación de formatos
    * Limpieza de texto
    * Creación de variables
    * Valores atípicos
    * Valores perdidos
    
## Recopilación

  + Depende de la fuente de información de interés

## Importación

Traer una base de datos externa y cargarla en el sistema de interés. En nuestro caso en R.

Hay varias librerías útiles para la importación

```{r}
rm(list=ls())
library(haven)# stata, spss, matlab, 
library(labelled) # permite trabajar con las etiquetas de bases de datos importadaS de stata o SPSS
library(readxl)# excel 
##################################
#importar la base de datos de las elecciones
bd20<-read.csv("C:/Users/PC18/Downloads/en2020.csv", sep="|")
getwd()
#
setwd("C:/Users/PC18/Documents/GitHub/big-data/data")#cambiar el directorio de trabajo
save(bd20,file="data/bd20.RData")#exportar a R
#cargar la base
rm(list = ls())
load("data/bd20.RData")
##censo
s1<-getwd()
setwd("C:/Users/PC18/Downloads/census-20230418T183736Z-001/census")
dir()
cs12d_8<-read_dta("DBdiscapacidad2012vf_8.dta")
cs12d_9<-read_dta("DBdiscapacidad2012vf_9.dta")
cs12m_8<-read_dta("DBmortalidad2012vf_8.dta")
cs12m_9<-read_dta("DBmortalidad2012vf_9.dta")
cs12p_8<-read_dta("DBpersonas2012vf_8.dta")
cs12p_9<-read_dta("DBpersonas2012vf_9.dta")
cs12v_8<-read_dta("DBvivienda2012vf_8.dta")
cs12v_9<-read_dta("DBvivienda2012vf_9.dta")
setwd(s1)
getwd()
save(cs12d_8,cs12d_9,cs12m_8,cs12m_9,cs12p_8,cs12p_9,cs12v_8,cs12v_9, file = "data/cs12.RData")
# Actividad: Realizar la importación de todas las bases de las encuestas a hogares y generar el RData correspondiente. (3:45)
setwd("C:/Users/PC18/Downloads/eh2021")
dir()
eh21de<-read_sav("EH2021_Defunciones.sav")
eh21di<-read_sav("EH2021_Discriminacion.sav")
eh21eq<-read_sav("EH2021_Equipamiento.sav")
eh21ga<-read_sav("EH2021_Gastos Alimentarios.sav")
eh21gn<-read_sav("EH2021_Gastos no Alimentarios.sav")
eh21p<-read_sav("EH2021_Persona.sav")
eh21sa<-read_sav("EH2021_Seguridad Alimentaria.sav")
eh21v<-read_sav("EH2021_Vivienda.sav")
setwd(s1)
save(eh21de,eh21di,eh21eq,eh21ga,eh21gn,eh21p,eh21sa,eh21v,file = "data/eh21.RData")
```

## Exploración

Ejemplo, en la base de datos de las elecciones 2020

  + Unidad de investigación (fila): Encontrar un ID, key.: Mesas electorales
  + Variables: Geográficas, identificación del recinto y la mesa, finalmente variables vinculadas a los votos por partido político.

```{r}
unique(bd20$Nombre.DEPARTAMENTO)
length(unique(bd20$Codigo.MESA))
names(bd20)
```

### Diccionario de variables

Es un listado de las variables y sus características de formato y alguna información adicional. Lo mas importante es saber que variables son cualitativas y cuales cuantitativas.

```{r}
str(bd20)#estrucutra 
str(bd20$VALIDOS)
```

### Niveles de agregación

La base de datos puede tener una unidad de investigación **elemental**, pero, puede tener también información de unidades de interés mas grandes, es decir; que agregen a los unidades elementales.

> Problema: Construir una base de datos a nivel de los recintos, con la información de los votos para el MAS, CC, VALIDOS.

```{r}
library(dplyr)# Gramática de datos SQL
# %>% operador pipe ctr+alt+m
bdre20<-bd20 %>% group_by(Codigo.RECINTO,Nombre.RECINTO) %>% summarise(sum(CC),sum(MAS.IPSP),sum(VALIDOS))
View(bdre20)
```

### Descripción univariada 

El objetivo es conocer estadísticas básicas de cada variable.

  + Cualitativas: Conteo, %
  + Cuantitativas: tendencia central, variabilidad, medidas de forma, densidad. 

### Identificando relaciones

El objetivo es tener una medida estadística que nos indique algo sobre la relación existente entre 2 o más variables.

  - Cuali vs cuali

```{r}
library(haven)
# Área pobreza
table(eh21p$area,eh21p$p0)
chisq.test(table(eh21p$area,eh21p$p0))
```

Test de independencia $/chi^2$

  - H0: Independencia

Cuanti vs cuanti: Lo más útil y práctico es hacer una **correlación**, sin embargo, lo que se estudia es una relación lineal, además son relaciones *casuales*

### Aproximación Visual (Visualización)


## Filtrado y selección
### Filtrado de observaciones
### Selección de variables
### Pivot, Reshape
### Uniendo bases de datos
## Muestreo, estimación, error estándar y confiabilidad
### Diseño muestral
### Estimación
### Rendimiento
## Transformación
### Adecuación de formatos
### Limpieza de texto
### Creación de variables
### Valores atípicos
### Valores perdidos